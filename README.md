# Hackathon_II_ALL_phases_TODO: Phase II - Full-Stack Todo Application

**Status**: ğŸš€ Phase II Implementation Started (T-201-207 Complete)

A production-ready full-stack todo application with JWT authentication, built with:
- **Frontend**: Next.js 16+ (App Router) + TypeScript + Tailwind CSS
- **Backend**: FastAPI + Python 3.13 + SQLModel ORM
- **Database**: PostgreSQL (Neon for production, Docker for local development)
- **Authentication**: JWT with shared secret (Better Auth integration planned for Phase III)

## Project Summary

This document summarizes the state of the Evo-TODO project, including the project structure and a summary of previously fixed issues.

### Project Structure

The project is a full-stack todo application with a Next.js frontend and a FastAPI backend.

-   **Frontend:** Next.js, React, TypeScript, Tailwind CSS
-   **Backend:** FastAPI, Python, SQLModel
-   **Database:** PostgreSQL
-   **Authentication:** JWT with Better Auth

Key directories:

-   `frontend/`: Contains the Next.js application.
-   `backend/`: Contains the FastAPI application.
-   `specs/`: Contains the project specifications and plans.
-   `history/`: Contains the prompt history records.

### Previously Fixed Issues

#### JWT Authentication

-   **Issue:** Users were immediately logged out after logging in.
-   **Root Cause:** A mismatch between the database schema expected by the backend and the schema created by Better Auth. The backend was querying a `users` table while Better Auth created a `user` table. There was also a type mismatch for the user ID (UUID vs. string).
-   **Fix:** The backend models were updated to match the Better Auth schema. The table name was changed to `user`, and the user ID type was changed to `str`.

#### Middleware

-   **Issue:** Login functionality broke due to improper session validation in the middleware.
-   **Root Cause:** Attempting to make database calls in the Next.js Edge Runtime middleware.
-   **Fix:** Switched to a cookie-based optimistic redirect approach in the middleware.

#### CRUD Endpoints

-   **Issue:** Missing `getTodoById` method, incorrect `PATCH` request format, and missing `description` field support.
-   **Fix:** The `useTodos` hook was updated to include the `getTodoById` method and to send the correct payload for `PATCH` requests.

#### Better Auth Integration

-   **Issue:** `Module not found: Can't resolve 'better-auth/react'`.
-   **Root Cause:** Incorrect import path in `lib/auth.ts` and `lib/auth-client.ts`.
-   **Fix:** The import path was corrected to `better-auth/react`.

#### General Frontend

-   **Issue:** 404 errors on `/login` and `/signup` pages.
-   **Root Cause:** Build cache issues and missing environment variables.
-   **Fix:** The build cache was cleared, and the `.env.local` file was configured correctly.

## Phase II Monorepo Structure

```
Evo-TODO/
â”œâ”€â”€ frontend/                   # Next.js 16+ React application (T-201)
â”‚   â”œâ”€â”€ app/                    # App Router directory
â”‚   â”‚   â”œâ”€â”€ layout.tsx          # Root layout
â”‚   â”‚   â”œâ”€â”€ page.tsx            # Landing page
â”‚   â”‚   â”œâ”€â”€ (auth)/             # Auth routes (Signin/Signup) - T-220/T-221
â”‚   â”‚   â”œâ”€â”€ (dashboard)/        # Protected routes - T-222/T-223
â”‚   â”‚   â””â”€â”€ globals.css         # Tailwind CSS
â”‚   â”œâ”€â”€ lib/                    # Utilities
â”‚   â”‚   â””â”€â”€ api.ts              # API client with JWT attachment - T-218
â”‚   â”œâ”€â”€ hooks/                  # React hooks
â”‚   â”‚   â””â”€â”€ useAuth.ts          # Authentication context - T-219
â”‚   â”œâ”€â”€ components/             # Reusable React components
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ next.config.js
â”‚   â””â”€â”€ Dockerfile              # Multi-stage build - T-205
â”‚
â”œâ”€â”€ backend/                    # FastAPI Python application (T-202)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py             # FastAPI entry point
â”‚   â”‚   â”œâ”€â”€ models/             # SQLModel entities - T-208/T-209
â”‚   â”‚   â”œâ”€â”€ api/                # Route handlers - T-215/T-216
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py         # Auth endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ todos.py        # Todo CRUD endpoints
â”‚   â”‚   â”‚   â””â”€â”€ deps.py         # FastAPI dependencies - T-214
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py       # Settings and environment - T-202
â”‚   â”‚   â”‚   â””â”€â”€ security.py     # JWT and password functions - T-213
â”‚   â”‚   â””â”€â”€ schemas/            # Pydantic models - T-211/T-212
â”‚   â”œâ”€â”€ tests/                  # Test files
â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”œâ”€â”€ Dockerfile              # Python 3.13 image - T-204
â”‚   â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ docker-compose.yml          # Orchestration (PostgreSQL + Backend + Frontend) - T-203
â”œâ”€â”€ .env.example                # Environment template - T-206
â””â”€â”€ README.md                   # This file (T-207)
```

## Prerequisites

- Docker & Docker Compose
- Node.js 18+ (for local frontend development)
- Python 3.13+ (for local backend development)
- PostgreSQL 15 (included in Docker Compose)

## Quick Start

### 1. Clone and Setup

```bash
# Clone the repository
git clone <repo-url>
cd Evo-TODO

# Checkout Phase II branch
git checkout phase2-001-setup

# Copy environment template
cp .env.example .env
cp frontend/.env.example frontend/.env.local
cp backend/.env.example backend/.env
```

### 2. Generate JWT Secret

```bash
# Generate a secure 256-bit secret
openssl rand -base64 32
# Copy output to .env JWT_SECRET_KEY
```

### 3. Run with Docker Compose

```bash
# Start all services (PostgreSQL, FastAPI, Next.js)
docker-compose up -d

# View logs
docker-compose logs -f

# Stop services
docker-compose down
```

Services will be available at:
- **Frontend**: http://localhost:3000
- **Backend**: http://localhost:8000
- **API Docs**: http://localhost:8000/docs (Swagger UI)
- **Database**: localhost:5432 (PostgreSQL)

### 4. Run Locally (Without Docker)

**Backend**:
```bash
cd backend
uv sync              # Install dependencies
cp .env.example .env # Configure
uvicorn app.main:app --reload
```

**Frontend**:
```bash
cd frontend
npm install
cp .env.example .env.local # Configure
npm run dev
```

## Architecture

### Phase II Monorepo Design

```
User Browser
    â†“
[Next.js Frontend]
    â”œâ”€ Static: UI components, routing, forms
    â”œâ”€ Dynamic: useAuth hook, API client
    â””â”€ Authenticated requests with JWT
    â†“ (HTTP/HTTPS + JWT in Authorization header)
[FastAPI Backend] (Task T-202)
    â”œâ”€ JWT Middleware: Validate token, extract user_id
    â”œâ”€ Dependencies: get_current_user() for protected routes
    â”œâ”€ Routes: /auth/*, /api/todos/*
    â””â”€ All queries filtered by user_id (data isolation)
    â†“ (SQL via SQLModel ORM)
[PostgreSQL Database]
    â”œâ”€ users table: id, email, password_hash, name, is_active, timestamps
    â””â”€ todos table: id, user_id (FK), title, description, is_complete, timestamps
```

### Security & Data Isolation (Constitution Compliance)

**Task T-201-207 Compliance**:
- âœ… Monorepo structure with `/frontend` and `/backend` separation
- âœ… Docker Compose for orchestration
- âœ… Environment variables from `.env` (no secrets in code)
- âœ… JWT authentication with shared secret (HS256)
- âœ… User data scoping at query level (WHERE user_id = <user_id>)
- âœ… API client auto-attaches JWT to all requests
- âœ… Every file references Task ID (comments + git commits)

## Implementation Tasks

### Phase 2.1: Monorepo Infrastructure (T-201 to T-207) âœ… COMPLETE

| Task | Description | Status |
|------|-------------|--------|
| T-201 | Initialize Next.js 16+ with App Router | âœ… Complete |
| T-202 | Initialize FastAPI with Python 3.13 | âœ… Complete |
| T-203 | Create Docker Compose configuration | âœ… Complete |
| T-204 | Create Backend Dockerfile | âœ… Complete |
| T-205 | Create Frontend Dockerfile | âœ… Complete |
| T-206 | Create Environment templates | âœ… Complete |
| T-207 | Create Root README | âœ… Complete |

### Phase 2.2: Database Schema (T-208 to T-212) â³ Next

| Task | Description | Status |
|------|-------------|--------|
| T-208 | Create SQLModel User entity | â³ Pending |
| T-209 | Create SQLModel Todo entity | â³ Pending |
| T-210 | Configure Database connection | â³ Pending |
| T-211 | Create User Pydantic schemas | â³ Pending |
| T-212 | Create Todo Pydantic schemas | â³ Pending |

### Phase 2.3: JWT Authentication (T-213 to T-215) â³ Next

- T-213: JWT security functions (started - in security.py)
- T-214: FastAPI dependencies
- T-215: Auth endpoints (signup, signin, logout)

### Phase 2.4: Todo CRUD API (T-216 to T-217) â³ Next

- T-216: Todo CRUD endpoints
- T-217: User data isolation verification

### Phase 2.5: Frontend Components (T-218 to T-224) â³ Next

- T-218: API client class
- T-219: useAuth hook
- T-220: Signin page
- T-221: Signup page
- T-222: Dashboard layout
- T-223: Todo list page
- T-224: Todo edit page

### Phase 2.6: Testing & Polish (T-225 to T-228) â³ Next

- T-225: Integration tests
- T-226: Full test suite
- T-227: Code review
- T-228: API documentation

## Configuration

### Environment Variables

**Backend (.env)**:
```env
DATABASE_URL=postgresql://evo_todo_user:evo_todo_password@localhost:5432/evo_todo
JWT_SECRET_KEY=your-256-bit-secret-key
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=168
CORS_ORIGINS=http://localhost:3000
ENVIRONMENT=development
```

**Frontend (.env.local)**:
```env
NEXT_PUBLIC_API_URL=http://localhost:8000
```

**Docker Compose (.env)**:
```env
POSTGRES_USER=evo_todo_user
POSTGRES_PASSWORD=evo_todo_password
POSTGRES_DB=evo_todo
JWT_SECRET_KEY=your-256-bit-secret-key
```

## API Documentation

Auto-generated API documentation available at:
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

Current endpoints (Task T-207):
- `GET /health` - Health check

Upcoming endpoints:
- **Auth** (T-215): POST /auth/signup, /auth/signin, /auth/logout
- **Todos** (T-216): GET /api/todos, POST /api/todos, GET /api/todos/{id}, PUT /api/todos/{id}, PATCH /api/todos/{id}, DELETE /api/todos/{id}

## Testing

Tests will be added in Phase 2.6 (T-225-226):
```bash
# Backend tests
cd backend && pytest tests/ -v

# Frontend tests
cd frontend && npm test

# E2E tests
cd frontend && npm run e2e
```

## Troubleshooting

### Docker Compose Issues

```bash
# View service logs
docker-compose logs postgres     # Database logs
docker-compose logs backend      # FastAPI logs
docker-compose logs frontend     # Next.js logs

# Reset everything
docker-compose down -v           # Remove volumes
docker-compose up -d             # Restart

# Health check
curl http://localhost:8000/health
curl http://localhost:3000
```

### Port Conflicts

If ports are in use:
```bash
# Change ports in docker-compose.yml
# Frontend: change "3000:3000" to "3001:3000"
# Backend: change "8000:8000" to "8001:8000"

# Update NEXT_PUBLIC_API_URL in frontend/.env.local
NEXT_PUBLIC_API_URL=http://localhost:8001
```

### Database Connection

```bash
# Connect to PostgreSQL directly
psql -U evo_todo_user -d evo_todo -h localhost

# Check tables
\dt            # List tables
\d users       # Describe users table
\d todos       # Describe todos table
```

## Development Workflow

### Git Branching Strategy

```
main/master
â””â”€â”€ phase-2 (final Phase II branch)
    â””â”€â”€ phase2-001-setup (Feature branch for T-201-207)
        â””â”€â”€ phase2-002-database (Feature branch for T-208-212)
        â””â”€â”€ phase2-003-auth (Feature branch for T-213-215)
        ...
```

### Commit Message Format

```
phase2-XXY-task-name: Brief description

Detailed explanation if needed

ğŸ¤– Generated with Claude Code

Co-Authored-By: Claude Haiku 4.5 <noreply@anthropic.com>
```

### Task Tracking

All tasks documented in [specs/002-phase-ii/tasks.md](./specs/002-phase-ii/tasks.md) with:
- Acceptance criteria
- Test cases
- Time estimates
- Dependencies

## Constitution Compliance

**Phase II Constitution (v2.0.0)** applied to all code:
- âœ… Full-stack web app with separation of concerns
- âœ… User-scoped data isolation (JWT + user_id filtering)
- âœ… Clean code principles (small focused functions)
- âœ… Task-driven implementation (all code mapped to Task IDs)
- âœ… Performance prioritized (indexes, async endpoints)
- âœ… No manual code writing (templates, scaffolding used)
- âœ… MCP integration (Context7 for debugging, Better Auth MCP for auth)

See [.specify/memory/constitution.md](./.specify/memory/constitution.md) for full details.

## References

- **Specification**: [specs/002-phase-ii/spec.md](./specs/002-phase-ii/spec.md)
- **Implementation Plan**: [specs/002-phase-ii/plan.md](./specs/002-phase-ii/plan.md)
- **Tasks**: [specs/002-phase-ii/tasks.md](./specs/002-phase-ii/tasks.md)
- **Data Model**: [specs/002-phase-ii/data-model.md](./specs/002-phase-ii/data-model.md)
- **API Contract**: [specs/002-phase-ii/api-contract.md](./specs/002-phase-ii/api-contract.md)
- **Constitution**: [.specify/memory/constitution.md](./.specify/memory/constitution.md)

## License

MIT

## Contributors

- Claude Haiku 4.5 (AI Assistant)
- Sheikh Muhammad Mujtaba (Project Owner)
